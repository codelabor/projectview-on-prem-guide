## 웹 서버 로그 설정

### Nginx 로그 설정

ProejctView에서는 웹서버로 nginx를 사용한다.
nginx의 로그를 일 단위로 보관하기 위해서는 logrotate 구성이 필요하다.
linux의 logrotate 기능을 이용하며 설정 시 sudo 권한이 필요하다.

installer 디렉토리의 스크립트를 실행한다.
```
projectview@projectview:~$ cd /app/installer
projectview@projectview:/app/installer$ ls
LICENSE                              README.md  config.env                  data                install.sh                        projectview-v2.0.5.tgz
Projectview_Open_Source_License.doc  common.sh  create_nginx_log_rotate.sh  docker-compose.yml  projectview-installer-v2.0.5.tar
projectview@projectview:/app/installer$ chmod a+x create_nginx_log_rotate.sh 
projectview@projectview:/app/installer$ sudo ./create_nginx_log_rotate.sh 
[sudo] password for projectview: 
** Change the path of nginx logrotate file. : /app/projectview
** Test logrotate. If probolem occured, please do trouble shooting or delete logrotate file for rollback.
WARNING: logrotate in debug mode does nothing except printing debug messages!  Consider using verbose mode (-v) instead if this is not what you want.

reading config file /etc/logrotate.d/nginx
Reading state from file: /var/lib/logrotate/status
Allocating hash table for state file, size 64 entries
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state
Creating new state

Handling 1 logs

rotating pattern: /app/projectview/logs/pms-server/access.log
/app/projectview/logs/pms-server/error.log
/app/projectview/logs/ph-server/access.log
/app/projectview/logs/ph-server/error.log
/app/projectview/logs/pms-nginx/access.log
/app/projectview/logs/pms-nginx/error.log
 forced from command line (no old logs will be kept)
empty log files are not rotated, old logs are removed
considering log /app/projectview/logs/pms-server/access.log
Creating new state
  Now: 2024-04-17 17:41
  Last rotated at 2024-04-17 17:00
  log needs rotating
considering log /app/projectview/logs/pms-server/error.log
Creating new state
  Now: 2024-04-17 17:41
  Last rotated at 2024-04-17 17:00
  log does not need rotating (log is empty)
considering log /app/projectview/logs/ph-server/access.log
Creating new state
  Now: 2024-04-17 17:41
  Last rotated at 2024-04-17 17:00
  log needs rotating
considering log /app/projectview/logs/ph-server/error.log
Creating new state
  Now: 2024-04-17 17:41
  Last rotated at 2024-04-17 17:00
  log needs rotating
considering log /app/projectview/logs/pms-nginx/access.log
Creating new state
  Now: 2024-04-17 17:41
  Last rotated at 2024-04-17 17:00
  log needs rotating
considering log /app/projectview/logs/pms-nginx/error.log
Creating new state
  Now: 2024-04-17 17:41
  Last rotated at 2024-04-17 17:00
  log needs rotating
rotating log /app/projectview/logs/pms-server/access.log, log->rotateCount is 0
dateext suffix '-20240417'
glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'
glob finding old rotated logs failed
rotating log /app/projectview/logs/ph-server/access.log, log->rotateCount is 0
dateext suffix '-20240417'
glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'
glob finding old rotated logs failed
rotating log /app/projectview/logs/ph-server/error.log, log->rotateCount is 0
dateext suffix '-20240417'
glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'
glob finding old rotated logs failed
rotating log /app/projectview/logs/pms-nginx/access.log, log->rotateCount is 0
dateext suffix '-20240417'
glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'
glob finding old rotated logs failed
rotating log /app/projectview/logs/pms-nginx/error.log, log->rotateCount is 0
dateext suffix '-20240417'
glob pattern '-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'
glob finding old rotated logs failed
copying /app/projectview/logs/pms-server/access.log to /app/projectview/logs/pms-server/access.log-20240417
truncating /app/projectview/logs/pms-server/access.log
copying /app/projectview/logs/ph-server/access.log to /app/projectview/logs/ph-server/access.log-20240417
truncating /app/projectview/logs/ph-server/access.log
copying /app/projectview/logs/ph-server/error.log to /app/projectview/logs/ph-server/error.log-20240417
truncating /app/projectview/logs/ph-server/error.log
copying /app/projectview/logs/pms-nginx/access.log to /app/projectview/logs/pms-nginx/access.log-20240417
truncating /app/projectview/logs/pms-nginx/access.log
copying /app/projectview/logs/pms-nginx/error.log to /app/projectview/logs/pms-nginx/error.log-20240417
truncating /app/projectview/logs/pms-nginx/error.log
```

logrotate 설정 파일을 확인한다.
```
projectview@projectview:/app/installer$ cd /etc/logrotate.d/
projectview@projectview:/etc/logrotate.d$ ls
alternatives  apport  apt  bootlog  btmp  cups-daemon  dpkg  nginx  ppp  rsyslog  sane-utils  speech-dispatcher  ubuntu-advantage-tools  ufw  unattended-upgrades  wtmp
projectview@projectview:/etc/logrotate.d$ vi nginx
```

파일 내용은 아래와 같다.
```
/app/projectview/logs/pms-server/access.log
/app/projectview/logs/pms-server/error.log
/app/projectview/logs/ph-server/access.log
/app/projectview/logs/ph-server/error.log
/app/projectview/logs/pms-nginx/access.log
/app/projectview/logs/pms-nginx/error.log
{
    su root root
    daily
    missingok
    dateext
    copytruncate
    notifempty
    create 644 root root
    sharedscripts
}
```